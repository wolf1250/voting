<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>行動應用投票</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" type="text/css" href="./resources/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="./resources/css/star-rating.css" media="all" />
    <style>
        .submit-btn {
            background-color: #4bacc6;
            color: #FFF;
            border: 2px solid #FFF;
            box-shadow: 3px 3px 5px #a0a0a0;
            position: fixed;
            padding: 6px 20px;
            right: 20px;
            top: 10px;
        }
        
        .submit-btn:focus {
            background-color: #4bacc6;
            color: #FFF;
            border: 2px solid #FFF;
            box-shadow: 3px 3px 5px #a0a0a0;
        }
        
        .media {
            border-bottom: 1px solid #000;
            padding-left: 10px;
            padding-bottom: 10px;
        }
        
        .media img {
            max-height: 100px;
        }
        
        .modal-center {
            text-align: center;
            padding: 0!important;
        }
        
        .modal-center:before {
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -4px;
        }
        
        .modal-center-dialog {
            display: inline-block;
            vertical-align: middle;
        }
        
        .rating-xs {
            font-size: 1.5em;
        }

    </style>

</head>

<body>
    <div class="container" style="margin-top: 20px;">

        <button class="btn btn-default submit-btn">送 出</button>

        <div class="row">
            <div class="media" style="padding-top:20px;">
                <div class="media-left">
                    <a href="#">
                        <img class="media-object" src="./resources/images/tab/tab_p1.png" alt="...">
                    </a>
                </div>
                <div class="media-body">
                    <span class="title">關鍵業務</span>
                    <input id="rating-1" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                    <span class="title">優先性</span>
                    <input id="rating-2" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                </div>
            </div>
            <br/>
        </div>

        <div class="row">
            <div class="media">
                <div class="media-left">
                    <a href="#">
                        <img class="media-object" src="./resources/images/tab/tab_p2.png" alt="...">
                    </a>
                </div>
                <div class="media-body">
                    <span class="title">關鍵業務</span>
                    <input id="rating-3" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                    <span class="title">優先性</span>
                    <input id="rating-4" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                </div>
            </div>
            <br/>
        </div>

        <div class="row">
            <div class="media">
                <div class="media-left">
                    <a href="#">
                        <img class="media-object" src="./resources/images/tab/tab_p3.png" alt="...">
                    </a>
                </div>
                <div class="media-body">
                    <span class="title">關鍵業務</span>
                    <input id="rating-5" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                    <span class="title">優先性</span>
                    <input id="rating-6" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                </div>
            </div>
            <br/>
        </div>

        <div class="row">
            <div class="media">
                <div class="media-left">
                    <a href="#">
                        <img class="media-object" src="./resources/images/tab/tab_p4.png" alt="...">
                    </a>
                </div>
                <div class="media-body">
                    <span class="title">關鍵業務</span>
                    <input id="rating-7" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                    <span class="title">優先性</span>
                    <input id="rating-8" class="kv-ltr-theme-fa-star rating-loading" value="0" dir="ltr">
                </div>
            </div>
            <br/>
        </div>
    </div>

    <div class="cookie" style="color:#FFF"></div>

    <!-- Modal -->
    <div class="modal fade modal-center" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog text-center modal-center-dialog" role="document" style="width:80%;">
            <img src="../resources/images/Eclipse.svg">
        </div>
    </div>

    <div class="modal fade modal-center" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-center-dialog" role="document">
            <div class="modal-content">

                <div class="modal-body text-center">
                    <h2>感謝您的參與</h2>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade modal-center" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-center-dialog" role="document">
            <div class="modal-content">

                <div class="modal-body text-center">
                    <h2>投票尚未完成</h2>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade modal-center" id="finishModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-center-dialog" role="document">
            <div class="modal-content">

                <div class="modal-body text-center">
                    <h2>感謝您的參與</h2>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade modal-center" id="repeatModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-center-dialog" role="document">
            <div class="modal-content">

                <div class="modal-body text-center">
                    <h2>您已完成投票</h2>
                    <h2>感謝您的參與</h2>
                </div>

            </div>
        </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="./resources/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="./resources/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="./resources/js/star-rating.js" type="text/javascript"></script>
    <script src="./resources/js/sockjs.min.js" type="text/javascript"></script>
    <script src="./resources/js/stomp.min.js" type="text/javascript"></script>
    <script src="./resources/js/my_socket.js" type="text/javascript"></script>
    <script>
        $(function() {
            $('.kv-ltr-theme-fa-star').rating({
                size: 'xs',
                hoverOnClear: false,
                theme: 'krajee-fa',
                showCaption: false,
                showClear: false
            });

            $('.cookie').text($.cookie(('v1-token')));

            $('.submit-btn').on('click', function() {
                
                var token = $.cookie(('v1-token'));

                var r1 = (parseFloat('' === $('#rating-1').val()? 0.0 : $('#rating-1').val())).toFixed(1);
                var r2 = (parseFloat('' === $('#rating-2').val()? 0.0 : $('#rating-2').val())).toFixed(1);
                var r3 = (parseFloat('' === $('#rating-3').val()? 0.0 : $('#rating-3').val())).toFixed(1);
                var r4 = (parseFloat('' === $('#rating-4').val()? 0.0 : $('#rating-4').val())).toFixed(1);
                var r5 = (parseFloat('' === $('#rating-5').val()? 0.0 : $('#rating-5').val())).toFixed(1);
                var r6 = (parseFloat('' === $('#rating-6').val()? 0.0 : $('#rating-6').val())).toFixed(1);
                var r7 = (parseFloat('' === $('#rating-7').val()? 0.0 : $('#rating-7').val())).toFixed(1);
                var r8 = (parseFloat('' === $('#rating-8').val()? 0.0 : $('#rating-8').val())).toFixed(1);
                console.log(r1 + ' :: ' + $('#rating-1').val() + ', ' + 
                            r2 + ' :: ' + $('#rating-2').val() + ', ' + 
                            r3 + ' :: ' + $('#rating-3').val() + ', ' + 
                            r4 + ' :: ' + $('#rating-4').val() + ', ' + 
                            r5 + ' :: ' + $('#rating-5').val() + ', ' + 
                            r6 + ' :: ' + $('#rating-6').val() + ', ' + 
                            r7 + ' :: ' + $('#rating-7').val() + ', ' + 
                            r8 + ' :: ' + $('#rating-8').val());

                console.log(token);

                var submit_data = [{
                        project_id: 1,
                        key_business: r1,
                        priority: r2,
                        token: token
                    },
                    {
                        project_id: 2,
                        key_business: r3,
                        priority: r4,
                        token: token
                    },
                    {
                        project_id: 3,
                        key_business: r5,
                        priority: r6,
                        token: token
                    },
                    {
                        project_id: 4,
                        key_business: r7,
                        priority: r8,
                        token: token
                    }
                ];

                $.ajax({
                    url: './voting_test2',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(submit_data),
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        console.log('before get score');

                        $('#loadingModal').modal({
                            backdrop: 'static',
                            keyboard: false
                        });
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        setTimeout(function() {
                            $('#loadingModal').modal('hide');
                            $('#errorModal').modal('show');
                        }, 1000);
                    },
                    success: function(data, textStatus, jqXHR) {

                        setTimeout(function() {
                            $('.submit-btn').attr('disabled', true);
                            $('#loadingModal').modal('hide');
                            if (data.result === 'false') {
                                $('#repeatModal').modal('show');
                            } else {
                                $('#finishModal').modal('show');
                            }
                        }, 1000);


                    }
                });
            });
        });

    </script>
</body>

</html>
